// ë©¤ë²„ ì‚­ì œ
        function deleteMember(name) {
            if (!confirm("'" + name + "' ë©¤ë²„ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                return;
            }

            // í˜„ì¬ ì„ íƒëœ ë©¤ë²„ ì €ì¥
            var currentSelectedMemberName = null;
            if (memberList.length > 0 && selectedMemberIndex >= 0 && selectedMemberIndex < memberList.length) {
                currentSelectedMemberName = memberList[selectedMemberIndex];
            }

            fetch('/api/member/' + currentYear + '/' + currentMonth + '/' + encodeURIComponent(name), {
                method: 'DELETE'
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.success) {
                    // ì‚­ì œëœ ë©¤ë²„ê°€ í˜„ì¬ ì„ íƒëœ ë©¤ë²„ì¸ ê²½ìš° ì²« ë²ˆì§¸ ë©¤ë²„ë¡œ ë³€ê²½
                    if (currentSelectedMemberName === name) {
                        selectedMemberIndex = 0;
                        loadCurrentMonthWithSync();
                    } else {
                        // ë‹¤ë¥¸ ë©¤ë²„ê°€ ì„ íƒëœ ê²½ìš° ì„ íƒ ìœ ì§€
                        loadCurrentMonthWithSync(currentSelectedMemberName);
                    }
                } else {
                    alert('ë©¤ë²„ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(function(error) {
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error);
            });
        }

        // ì—­í•  ë³€ê²½ ì™„ë£Œ í›„ ì—…ë°ì´íŠ¸
        function updateMemberRole() {
            if (!editingMember) return;

            // í˜„ì¬ ì„ íƒëœ ë©¤ë²„ ì €ì¥
            var currentSelectedMemberName = null;
            if (memberList.length > 0 && selectedMemberIndex >= 0 && selectedMemberIndex < memberList.length) {
                currentSelectedMemberName = memberList[selectedMemberIndex];
            }

            var newRole = document.getElementById('newRole').value;

            fetch('/api/member_role', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    year: currentYear,
                    month: currentMonth,
                    name: editingMember,
                    role: newRole
                })
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.success) {
                    closeRoleModal();
                    // ì—­í•  ë³€ê²½ í›„ ì„ íƒ ìœ ì§€í•˜ë©´ì„œ ì—…ë°ì´íŠ¸
                    loadCurrentMonthWithSync(currentSelectedMemberName);
                } else {
                    alert('ì—­í•  ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(function(error) {
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error);
            });
        }

        // ë©¤ë²„ ê´€ë¦¬ì™€ ì¶œì„ í˜„í™©ì„ ë™ê¸°í™”í•˜ì—¬ ë¡œë“œ
        function loadCurrentMonthWithSync(selectedMemberName) {
            // ë©¤ë²„ ê´€ë¦¬ ë¨¼ì € ë¡œë“œ
            loadMemberManagement();

            // ì¶œì„ í˜„í™©ì„ ì„ íƒëœ ë©¤ë²„ì™€ í•¨ê»˜ ë¡œë“œ
            if (selectedMemberName) {
                loadAttendanceTableWithMemberSelection(selectedMemberName);
            } else {
                loadAttendanceTable();
            }
        }

        // ì—­í•  ë³€ê²½ ëª¨ë‹¬
        function openRoleModal(name, currentRole) {
            editingMember = name;
            document.getElementById('roleModalMemberName').textContent = name + 'ì˜ ì—­í•  ë³€ê²½';
            document.getElementById('newRole').value = currentRole;
            document.getElementById('roleModal').style.display = 'block';
        }

        function closeRoleModal() {
            document.getElementById('roleModal').style.display = 'none';
            editingMember = null;
        }

        // ë©¤ë²„ ê´€ë¦¬ ë¡œë“œ
        function loadMemberManagement() {
            var container = document.getElementById('memberManagement');
            container.innerHTML = '<div class="loading">ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

            fetch('/api/members/' + currentYear + '/' + currentMonth)
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                currentMembers = data;
                displayMemberManagement(data);
            })
            .catch(function(error) {
                container.innerHTML = '<div class="error">ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error + '</div>';
            });
        }

        // ë©¤ë²„ ê´€ë¦¬ í™”ë©´ í‘œì‹œ
        function displayMemberManagement(members) {
            var container = document.getElementById('memberManagement');

            if (Object.keys(members).length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;"><h3>ë“±ë¡ëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤</h3><p>ìœ„ì˜ "ë©¤ë²„ ì¶”ê°€" ì„¹ì…˜ì—ì„œ ìƒˆ ë©¤ë²„ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ "ì „ì›” ë©¤ë²„ ë³µì‚¬" ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì„¸ìš”.</p></div>';
                return;
            }

            // ë©¤ë²„ë¥¼ order ìˆœìœ¼ë¡œ ì •ë ¬
            var memberEntries = Object.keys(members);
            memberEntries.sort(function(a, b) {
                var orderA = members[a].order || 0;
                var orderB = members[b].order || 0;
                return orderA - orderB;
            });

            var html = '<div class="member-management" id="sortable-members">';

            for (var i = 0; i < memberEntries.length; i++) {
                var name = memberEntries[i];
                var member = members[name];

                html += '<div class="member-card" data-member-name="' + name + '">';
                html += '<div class="drag-handle" title="ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½">â‹®â‹®</div>';
                html += '<div class="member-info">';
                html += '<div class="member-name">' + name + '</div>';
                html += '<div class="member-role">' + member.role + '</div>';
                html += '</div>';
                html += '<div class="member-actions">';
                html += '<button class="btn-warning" onclick="openRoleModal(\'' + name + '\', \'' + member.role + '\')">ì—­í•  ë³€ê²½</button>';
                html += '<button class="btn-danger" onclick="deleteMember(\'' + name + '\')">ì‚­ì œ</button>';
                html += '</div>';
                html += '</div>';
            }

            html += '</div>';
            container.innerHTML = html;

            // Sortable ì´ˆê¸°í™”
            setTimeout(function() {
                initializeSortable();
            }, 100);
        }

        // Sortable ì´ˆê¸°í™”
        function initializeSortable() {
            var memberContainer = document.querySelector('#sortable-members');

            if (!memberContainer) return;
            if (typeof Sortable === 'undefined') return;

            if (memberContainer.sortableInstance) {
                memberContainer.sortableInstance.destroy();
            }

            memberContainer.sortableInstance = Sortable.create(memberContainer, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                handle: '.drag-handle',
                onEnd: function(evt) {
                    if (evt.oldIndex !== evt.newIndex) {
                        updateMemberOrderByDrag(evt.oldIndex, evt.newIndex);
                    }
                }
            });
        }

        // ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½
        function updateMemberOrderByDrag(oldIndex, newIndex) {
            var memberNames = Object.keys(currentMembers);
            memberNames.sort(function(a, b) {
                var orderA = currentMembers[a].order || 0;
                var orderB = currentMembers[b].order || 0;
                return orderA - orderB;
            });

            // í˜„ì¬ ì„ íƒëœ ë©¤ë²„ ì´ë¦„ ì €ì¥ (ì¹´ë“œë·°ìš©)
            var currentSelectedMemberName = null;
            if (memberList.length > 0 && selectedMemberIndex >= 0 && selectedMemberIndex < memberList.length) {
                currentSelectedMemberName = memberList[selectedMemberIndex];
            }

            // ë°°ì—´ì—ì„œ ìš”ì†Œ ì´ë™
            var movedMember = memberNames.splice(oldIndex, 1)[0];
            memberNames.splice(newIndex, 0, movedMember);

            // ìƒˆë¡œìš´ order ê°’ë“¤ ìƒì„±
            var orders = [];
            for (var i = 0; i < memberNames.length; i++) {
                orders.push({
                    name: memberNames[i],
                    order: i
                });
            }

            // ì„œë²„ì— ì—…ë°ì´íŠ¸ ìš”ì²­
            fetch('/api/member_orders', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    year: currentYear,
                    month: currentMonth,
                    orders: orders
                })
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.success) {
                    // ë©¤ë²„ ê´€ë¦¬ì™€ ì¶œì„ í˜„í™© ëª¨ë‘ ì—…ë°ì´íŠ¸
                    loadMemberManagement();

                    // ì¶œì„ í˜„í™©ë„ ì—…ë°ì´íŠ¸í•˜ë˜, ì¹´ë“œë·°ì—ì„œ ì„ íƒëœ ë©¤ë²„ ìœ ì§€
                    loadAttendanceTableWithMemberSelection(currentSelectedMemberName);
                } else {
                    alert('ìˆœì„œ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    loadCurrentMonth();
                }
            })
            .catch(function(error) {
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error);
                loadCurrentMonth();
            });
        }

        // ì„ íƒëœ ë©¤ë²„ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì¶œì„ í…Œì´ë¸” ë¡œë“œ
        function loadAttendanceTableWithMemberSelection(selectedMemberName) {
            var container = document.getElementById('attendanceTable');
            container.innerHTML = '<div class="loading">ì¶œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

            fetch('/api/monthly_report/' + currentYear + '/' + currentMonth)
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                // Exportìš© ë°ì´í„° ì €ì¥
                currentReportData = data;

                // ìƒˆë¡œìš´ ìˆœì„œë¡œ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                var memberEntries = Object.keys(data.members || data);
                memberEntries.sort(function(a, b) {
                    var dataObj = data.members || data;
                    var orderA = dataObj[a].order || 0;
                    var orderB = dataObj[b].order || 0;
                    return orderA - orderB;
                });

                // ì´ì „ì— ì„ íƒëœ ë©¤ë²„ì˜ ìƒˆë¡œìš´ ì¸ë±ìŠ¤ ì°¾ê¸°
                if (selectedMemberName && memberEntries.indexOf(selectedMemberName) !== -1) {
                    selectedMemberIndex = memberEntries.indexOf(selectedMemberName);
                } else {
                    // ì´ì „ ì„ íƒì´ ì—†ê±°ë‚˜ í•´ë‹¹ ë©¤ë²„ê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ë©¤ë²„ ì„ íƒ
                    selectedMemberIndex = 0;
                }

                displayAttendanceTable(data, currentYear, currentMonth);
            })
            .catch(function(error) {
                container.innerHTML = '<div class="error">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error + '</div>';
            });
        }

        // ì¶œì„ í…Œì´ë¸” ë¡œë“œ
        function loadAttendanceTable() {
            var container = document.getElementById('attendanceTable');
            container.innerHTML = '<div class="loading">ì¶œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

            fetch('/api/monthly_report/' + currentYear + '/' + currentMonth)
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                // Exportìš© ë°ì´í„° ì €ì¥
                currentReportData = data;
                displayAttendanceTable(data, currentYear, currentMonth);
            })
            .catch(function(error) {
                container.innerHTML = '<div class="error">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error + '</div>';
            });
        }

        // ì¶œì„ í…Œì´ë¸” í‘œì‹œ
        function displayAttendanceTable(responseData, year, month) {
            var container = document.getElementById('attendanceTable');
            var data = responseData.members || responseData;
            var dates = responseData.dates || [];

            if (Object.keys(data).length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;"><h3>ë“±ë¡ëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤</h3><p>ìœ„ì˜ "ë©¤ë²„ ì¶”ê°€" ì„¹ì…˜ì—ì„œ ìƒˆ ë©¤ë²„ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ "ì „ì›” ë©¤ë²„ ë³µì‚¬" ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì„¸ìš”.</p></div>';
                return;
            }

            // ë©¤ë²„ë¥¼ order ìˆœìœ¼ë¡œ ì •ë ¬
            var memberEntries = Object.keys(data);
            memberEntries.sort(function(a, b) {
                var orderA = data[a].order || 0;
                var orderB = data[b].order || 0;
                return orderA - orderB;
            });

            // ë‚ ì§œê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ë©¤ë²„ì˜ ì¶œì„ ë°ì´í„°ì—ì„œ ì¶”ì¶œ
            var finalDates = dates;
            if (finalDates.length === 0 && memberEntries.length > 0) {
                finalDates = Object.keys(data[memberEntries[0]].attendance || {}).sort();
            }

            var html = '';

            // í˜„ì¬ ì‚¬ìš©í•  ë·° ê²°ì •
            var viewToUse = getCurrentView();

            // ë·° í† ê¸€ ë²„íŠ¼ (PCì™€ ëª¨ë°”ì¼ ëª¨ë‘ í‘œì‹œ)
            html += '<div class="view-toggle">';

            if (viewToUse === 'table') {
                html += '<button id="tableViewBtn" class="active" onclick="switchToTableView()">ğŸ“Š í…Œì´ë¸” ë·°</button>';
                html += '<button id="cardViewBtn" onclick="switchToCardView()">ğŸ“‹ ì¹´ë“œ ë·°</button>';
            } else {
                html += '<button id="tableViewBtn" onclick="switchToTableView()">ğŸ“Š í…Œì´ë¸” ë·°</button>';
                html += '<button id="cardViewBtn" class="active" onclick="switchToCardView()">ğŸ“‹ ì¹´ë“œ ë·°</button>';
            }

            html += '</div>';

            // ë°ìŠ¤í¬í†± í…Œì´ë¸” ë·°
            html += '<div class="desktop-view"' + (viewToUse === 'table' ? '' : ' style="display: none;"') + '>';
            html += generateTableView(data, memberEntries, finalDates, year, month);
            html += '</div>';

            // ëª¨ë°”ì¼ ì¹´ë“œ ë·°
            html += '<div class="mobile-view"' + (viewToUse === 'card' ? '' : ' style="display: none;"') + '>';
            html += generateCardView(data, memberEntries, finalDates, year, month);
            html += '</div>';

            // ë²”ë¡€ ì¶”ê°€
            html += '<div style="margin-top: 30px; padding: 25px; background: #f8f9fa; border-radius: 10px;">';
            html += '<h3>ğŸ“‹ ì¶œì„ ì¡°ê±´ ë° ì‚¬ìš©ë²•</h3>';
            html += '<ul style="list-style: none; margin: 15px 0;">';
            html += '<li style="padding: 5px 0;">â–¶ <strong>ìš´ì˜ì§„:</strong> ì¶œì„ ì¡°ê±´ ì—†ìŒ</li>';
            html += '<li style="padding: 5px 0;">â–¶ <strong>í˜ì´ì„œ:</strong> ì›” 3íšŒ ì´ìƒ ì¶œì„</li>';
            html += '<li style="padding: 5px 0;">â–¶ <strong>í˜ì´ì„œ ê°•ë‚¨:</strong> ì›” 3íšŒ ì´ìƒ ì¶œì„ (ê·¸ ì¤‘ ìˆ˜ìš”ì¼ 2íšŒ ì´ìƒ)</li>';
            html += '<li style="padding: 5px 0;">â–¶ <strong>í¬í† :</strong> ì›” 1íšŒ ì´ìƒ ì¶œì„</li>';
            html += '</ul>';
            html += '<div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin-top: 15px; border-radius: 0 8px 8px 0;">';
            html += '<p style="margin: 5px 0; color: #1565c0;"><strong>ğŸ’¡ ì‚¬ìš©ë²•:</strong></p>';
            html += '<p style="margin: 5px 0; color: #1565c0;">â€¢ ì¶œì„ ì…€ì„ í´ë¦­í•˜ë©´ ì¶œì„/ë¶ˆì°¸ì´ í† ê¸€ë©ë‹ˆë‹¤</p>';
            html += '<p style="margin: 5px 0; color: #1565c0;">â€¢ ì´ˆë¡ìƒ‰ ë°°ê²½: ì¶œì„ ì¡°ê±´ ì¶©ì¡± âœ…</p>';
            html += '<p style="margin: 5px 0; color: #1565c0;">â€¢ ë¹¨ê°„ìƒ‰ ë°°ê²½: ì¶œì„ ì¡°ê±´ ë¯¸ì¶©ì¡± âŒ</p>';
            if (isMobile()) {
                html += '<p style="margin: 5px 0; color: #1565c0;">â€¢ ğŸ“± ëª¨ë°”ì¼: ê¸°ë³¸ ì¹´ë“œ ë·°, ë©¤ë²„ë³„ ê°œë³„ í™•ì¸</p>';
            } else {
                html += '<p style="margin: 5px 0; color: #1565c0;">â€¢ ğŸ–¥ï¸ PC: ê¸°ë³¸ í…Œì´ë¸” ë·°, ì „ì²´ í•œëˆˆì— í™•ì¸</p>';
            }
            html += '</div>';
            html += '</div>';

            container.innerHTML = html;

            // í˜„ì¬ ë·° ìƒíƒœ ì„¤ì •
            currentView = viewToUse;
        }

        // í…Œì´ë¸” ë·° ìƒì„±
        function generateTableView(data, memberEntries, finalDates, year, month) {
            var isMobile = window.innerWidth <= 768;
            var html = '';

            if (isMobile && finalDates.length > 4) {
                html += '<div style="text-align: center; color: #666; font-size: 0.9em; margin-bottom: 10px; padding: 8px; background: #f8f9fa; border-radius: 4px;">ğŸ“± í‘œë¥¼ ì¢Œìš°ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ëª¨ë“  ë‚ ì§œë¥¼ í™•ì¸í•˜ì„¸ìš”</div>';
            }

            html += '<div class="table-container">';
            html += '<table class="attendance-table">';

            // í—¤ë”
            html += '<thead><tr>';
            html += '<th style="min-width: 60px;">ì§ì±…</th>';
            html += '<th style="min-width: 80px;">ì„±ëª…</th>';
            html += '<th style="min-width: 50px;">í•©ê³„</th>';

            for (var i = 0; i < finalDates.length; i++) {
                var date = finalDates[i];
                var dateObj = new Date(date);
                var weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                var weekday = weekdays[dateObj.getDay()];
                var day = dateObj.getDate();
                html += '<th style="min-width: 50px;">' + month + 'ì›”<br>' + day + 'ì¼<br>' + weekday + '</th>';
            }
            html += '</tr></thead>';

            // ë°”ë””
            html += '<tbody>';
            for (var memberIndex = 0; memberIndex < memberEntries.length; memberIndex++) {
                var name = memberEntries[memberIndex];
                var info = data[name];

                if (!info || !info.stats) continue;

                var stats = info.stats;
                var rowClass = stats.meets_requirement ? 'pass' : 'fail';

                html += '<tr class="' + rowClass + '">';
                html += '<td><strong>' + (info.role || 'ë¯¸ì •') + '</strong></td>';
                html += '<td><strong>' + name + '</strong></td>';
                html += '<td><strong>' + (stats.total || 0) + '</strong></td>';

                for (var dateIndex = 0; dateIndex < finalDates.length; dateIndex++) {
                    var date = finalDates[dateIndex];
                    var attendance = info.attendance || {};
                    var status = attendance[date] || 0;
                    var cellClass = status === 1 ? 'present' : 'absent';
                    var displayText = status === 1 ? '1' : '0';

                    html += '<td class="attendance-cell ' + cellClass + '" onclick="toggleAttendance(\'' + name + '\', \'' + date + '\', this)" title="' + name + ' - ' + date + ' í´ë¦­í•˜ì—¬ ë³€ê²½">';
                    html += displayText;
                    html += '</td>';
                }
                html += '</tr>';
            }
            html += '</tbody></table></div>';

            return html;
        }

        // ì¹´ë“œ ë·° ìƒì„± - ì„ íƒëœ ë©¤ë²„ë§Œ í‘œì‹œ
        function generateCardView(data, memberEntries, finalDates, year, month) {
            memberList = memberEntries; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥

            var html = '';

            // ë©¤ë²„ ì„ íƒ ë“œë¡­ë‹¤ìš´
            html += '<div class="member-selector">';
            html += '<label>ğŸ‘¤ ë©¤ë²„ ì„ íƒ:</label>';
            html += '<select id="memberSelect" onchange="changeMember()">';
            for (var i = 0; i < memberEntries.length; i++) {
                var name = memberEntries[i];
                var selected = i === selectedMemberIndex ? ' selected' : '';
                html += '<option value="' + i + '"' + selected + '>' + name + '</option>';
            }
            html += '</select>';
            html += '</div>';

            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
            html += '<div class="card-navigation">';
            html += '<button class="nav-button" onclick="previousMember()" ' + (selectedMemberIndex <= 0 ? 'disabled' : '') + '>â† ì´ì „</button>';
            html += '<div class="member-indicator">' + (selectedMemberIndex + 1) + ' / ' + memberEntries.length + '</div>';
            html += '<button class="nav-button" onclick="nextMember()" ' + (selectedMemberIndex >= memberEntries.length - 1 ? 'disabled' : '') + '>ë‹¤ìŒ â†’</button>';
            html += '</div>';

            // ì„ íƒëœ ë©¤ë²„ ì¹´ë“œ í‘œì‹œ
            html += '<div class="single-card-container">';

            if (memberEntries.length === 0) {
                html += '<div class="no-member-selected">';
                html += '<h3>ë“±ë¡ëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤</h3>';
                html += '<p>ë©¤ë²„ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>';
                html += '</div>';
            } else if (selectedMemberIndex >= 0 && selectedMemberIndex < memberEntries.length) {
                var name = memberEntries[selectedMemberIndex];
                var info = data[name];

                if (info && info.stats) {
                    var stats = info.stats;
                    var cardClass = stats.meets_requirement ? 'pass' : 'fail';

                    html += '<div class="member-card-view ' + cardClass + '" style="width: 100%; max-width: 600px;">';

                    // ë©¤ë²„ í—¤ë”
                    html += '<div class="member-header-mobile">';
                    html += '<div class="member-name-mobile">' + name + '</div>';
                    html += '<div class="member-role-mobile">' + (info.role || 'ë¯¸ì •') + '</div>';
                    html += '</div>';

                    // í†µê³„
                    html += '<div class="member-stats-mobile">';
                    html += '<div class="stat-item">';
                    html += '<div class="stat-label">ì´ ì¶œì„</div>';
                    html += '<div class="stat-value">' + (stats.total || 0) + 'íšŒ</div>';
                    html += '</div>';
                    html += '<div class="stat-item">';
                    html += '<div class="stat-label">ìˆ˜ìš”ì¼ ì¶œì„</div>';
                    html += '<div class="stat-value">' + (stats.wednesday || 0) + 'íšŒ</div>';
                    html += '</div>';
                    html += '<div class="stat-item">';
                    html += '<div class="stat-label">ì¡°ê±´ ì¶©ì¡±</div>';
                    html += '<div class="stat-value">' + (stats.meets_requirement ? 'âœ…' : 'âŒ') + '</div>';
                    html += '</div>';
                    html += '</div>';

                    // ì¶œì„ ê·¸ë¦¬ë“œ
                    html += '<div class="attendance-grid-mobile">';
                    for (var dateIndex = 0; dateIndex < finalDates.length; dateIndex++) {
                        var date = finalDates[dateIndex];
                        var dateObj = new Date(date);
                        var weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                        var weekday = weekdays[dateObj.getDay()];
                        var day = dateObj.getDate();

                        var attendance = info.attendance || {};
                        var status = attendance[date] || 0;
                        var itemClass = status === 1 ? 'present' : 'absent';
                        var displayText = status === 1 ? 'ì¶œì„' : 'ë¶ˆì°¸';

                        html += '<div class="attendance-item-mobile ' + itemClass + '" onclick="toggleAttendance(\'' + name + '\', \'' + date + '\', this)" title="' + name + ' - ' + date + ' í´ë¦­í•˜ì—¬ ë³€ê²½">';
                        html += '<div class="date-label-mobile">' + month + '/' + day + '<br>' + weekday + '</div>';
                        html += '<div class="attendance-value-mobile">' + displayText + '</div>';
                        html += '</div>';
                    }
                    html += '</div>';

                    html += '</div>';
                }
            }

            html += '</div>';

            return html;
        }

        // ë©¤ë²„ ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤
        function previousMember() {
            if (selectedMemberIndex > 0) {
                selectedMemberIndex--;
                updateCardViewOnly(); // ì¹´ë“œë·°ë§Œ ì—…ë°ì´íŠ¸, ë·° ë³€ê²½ ì•ˆí•¨
            }
        }

        function nextMember() {
            if (selectedMemberIndex < memberList.length - 1) {
                selectedMemberIndex++;
                updateCardViewOnly(); // ì¹´ë“œë·°ë§Œ ì—…ë°ì´íŠ¸, ë·° ë³€ê²½ ì•ˆí•¨
            }
        }

        function changeMember() {
            var select = document.getElementById('memberSelect');
            if (select) {
                selectedMemberIndex = parseInt(select.value);
                updateCardViewOnly(); // ì¹´ë“œë·°ë§Œ ì—…ë°ì´íŠ¸, ë·° ë³€ê²½ ì•ˆí•¨
            }
        }

        // ì¹´ë“œ ë·°ë§Œ ì—…ë°ì´íŠ¸ (ë·° ë³€ê²½ ì—†ì´)
        function updateCardViewOnly() {
            // í˜„ì¬ ì„ íƒëœ ë©¤ë²„ ì´ë¦„ ì €ì¥
            var currentSelectedMemberName = null;
            if (memberList.length > 0 && selectedMemberIndex >= 0 && selectedMemberIndex < memberList.length) {
                currentSelectedMemberName = memberList[selectedMemberIndex];
            }

            // ì¹´ë“œë·° ë¶€ë¶„ë§Œ ì—…ë°ì´íŠ¸
            var mobileView = document.querySelector('.mobile-view');
            if (mobileView && currentView === 'card') {
                // í˜„ì¬ ë°ì´í„°ë¡œ ì¹´ë“œë·° ë‚´ìš©ë§Œ ë‹¤ì‹œ ìƒì„±
                fetch('/api/monthly_report/' + currentYear + '/' + currentMonth)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    var memberEntries = Object.keys(data.members || data);
                    memberEntries.sort(function(a, b) {
                        var dataObj = data.members || data;
                        var orderA = dataObj[a].order || 0;
                        var orderB = dataObj[b].order || 0;
                        return orderA - orderB;
                    });

                    var finalDates = data.dates || [];
                    if (finalDates.length === 0 && memberEntries.length > 0) {
                        finalDates = Object.keys((data.members || data)[memberEntries[0]].attendance || {}).sort();
                    }

                    var cardViewHTML = generateCardView(data.members || data, memberEntries, finalDates, currentYear, currentMonth);
                    mobileView.innerHTML = cardViewHTML;
                })
                .catch(function(error) {
                    console.error('ì¹´ë“œë·° ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                });
            }
        }

        // ë·° ì „í™˜ í•¨ìˆ˜ë“¤
        function switchToCardView() {
            var desktopView = document.querySelector('.desktop-view');
            var mobileView = document.querySelector('.mobile-view');
            var cardBtn = document.getElementById('cardViewBtn');
            var tableBtn = document.getElementById('tableViewBtn');

            if (desktopView) {
                desktopView.style.display = 'none';
                desktopView.classList.add('inactive');
            }
            if (mobileView) {
                mobileView.style.display = 'block';
                mobileView.classList.add('active');
            }
            if (cardBtn) cardBtn.classList.add('active');
            if (tableBtn) tableBtn.classList.remove('active');

            currentView = 'card';
            userSelectedView = 'card'; // ì‚¬ìš©ìê°€ ì§ì ‘ ì„ íƒí–ˆìŒì„ ê¸°ë¡

            // ì¹´ë“œ ë·°ë¡œ ì „í™˜ ì‹œ ì²« ë²ˆì§¸ ë©¤ë²„ ì„ íƒ (ì¸ë±ìŠ¤ê°€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ” ê²½ìš°ë§Œ)
            if (selectedMemberIndex < 0 || selectedMemberIndex >= memberList.length) {
                selectedMemberIndex = 0;
            }
        }

        function switchToTableView() {
            var desktopView = document.querySelector('.desktop-view');
            var mobileView = document.querySelector('.mobile-view');
            var cardBtn = document.getElementById('cardViewBtn');
            var tableBtn = document.getElementById('tableViewBtn');

            if (desktopView) {
                desktopView.style.display = 'block';
                desktopView.classList.remove('inactive');
            }
            if (mobileView) {
                mobileView.style.display = 'none';
                mobileView.classList.remove('active');
            }
            if (tableBtn) tableBtn.classList.add('active');
            if (cardBtn) cardBtn.classList.remove('active');

            currentView = 'table';
            userSelectedView = 'table'; // ì‚¬ìš©ìê°€ ì§ì ‘ ì„ íƒí–ˆìŒì„ ê¸°ë¡
        }

        // ì¶œì„ í† ê¸€
        function toggleAttendance(name, date, cell) {
            var currentStatus = cell.classList.contains('present') ? 1 : 0;
            var newStatus = currentStatus === 1 ? 0 : 1;

            fetch('/api/attendance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    year: currentYear,
                    month: currentMonth,
                    name: name,
                    date: date,
                    status: newStatus
                })
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.success) {
                    // ì¦‰ì‹œ ì…€ ìƒíƒœ ì—…ë°ì´íŠ¸
                    cell.classList.remove('present', 'absent');
                    cell.classList.add(newStatus === 1 ? 'present' : 'absent');

                    // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                    var valueElement = cell.querySelector('.attendance-value-mobile');
                    if (valueElement) {
                        valueElement.textContent = newStatus === 1 ? 'ì¶œì„' : 'ë¶ˆì°¸';
                    } else {
                        cell.textContent = newStatus === 1 ? '1' : '0';
                    }

                    // í†µê³„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ í…Œì´ë¸” ë‹¤ì‹œ ë¡œë“œ
                    setTimeout(function() {
                        loadAttendanceTable();
                    }, 100);
                } else {
                    alert('ì¶œì„ ì •ë³´ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(function(error) {
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error);
            });
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type, container) {
            container.innerHTML = '<div class="' + type + '">' + message + '</div>';
            setTimeout(function() {
                container.innerHTML = '';
            }, 5000);
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            var modal = document.getElementById('roleModal');
            if (event.target === modal) {
                closeRoleModal();
            }
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthenticationStatus();
            
            // ì•”í˜¸ ì…ë ¥ í•„ë“œ ì„¤ì •
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleLogin(e);
                    }
                });
                passwordInput.focus();
            }
        });
    </script>
</body>
</html>        
        // Excel ë°ì´í„° ìƒì„±
        function generateExcelData(reportData) {
            var data = reportData.members || reportData;
            var dates = reportData.dates || [];
            
            // ë©¤ë²„ë¥¼ order ìˆœìœ¼ë¡œ ì •ë ¬
            var memberEntries = Object.keys(data);
            memberEntries.sort(function(a, b) {
                var orderA = data[a].order || 0;
                var orderB = data[b].order || 0;
                return orderA - orderB;
            });
            
            var result = [];
            
            // í—¤ë” í–‰
            var header = ['ì§ì±…', 'ì„±ëª…', 'í•©ê³„'];
            for (var i = 0; i < dates.length; i++) {
                var date = new Date(dates[i]);
                var month = date.getMonth() + 1;
                var day = date.getDate();
                var weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                var weekday = weekdays[date.getDay()];
                header.push(month + '/' + day + '(' + weekday + ')');
            }
            result.push(header);
            
            // ë°ì´í„° í–‰
            for (var memberIndex = 0; memberIndex < memberEntries.length; memberIndex++) {
                var name = memberEntries[memberIndex];
                var info = data[name];
                
                if (!info || !info.stats) continue;
                
                var row = [
                    info.role || 'ë¯¸ì •',
                    name,
                    info.stats.total || 0
                ];
                
                for (var dateIndex = 0; dateIndex < dates.length; dateIndex++) {
                    var date = dates[dateIndex];
                    var attendance = info.attendance || {};
                    var status = attendance[date] || 0;
                    row.push(status === 1 ? 'ì¶œì„' : 'ë¶ˆì°¸');
                }
                
                result.push(row);
            }
            
            return result;
        }
        
        // ìš”ì•½ í†µê³„ ë°ì´í„° ìƒì„±
        function generateSummaryData(reportData) {
            var data = reportData.members || reportData;
            var memberEntries = Object.keys(data);
            memberEntries.sort(function(a, b) {
                var orderA = data[a].order || 0;
                var orderB = data[b].order || 0;
                return orderA - orderB;
            });
            
            var result = [];
            result.push(['ì´ë¦„', 'ì§ì±…', 'ì´ ì¶œì„', 'ìˆ˜ìš”ì¼ ì¶œì„', 'ì¡°ê±´ ì¶©ì¡±', 'ë‹¬ì„±ë¥ (%)']);
            
            for (var i = 0; i < memberEntries.length; i++) {
                var name = memberEntries[i];
                var info = data[name];
                
                if (!info || !info.stats) continue;
                
                var stats = info.stats;
                var role = info.role || 'ë¯¸ì •';
                
                // ë‹¬ì„±ë¥  ê³„ì‚°
                var achievementRate = 0;
                if (role !== 'ìš´ì˜ì§„' && stats.required_total > 0) {
                    achievementRate = Math.round((stats.total / stats.required_total) * 100);
                }
                
                result.push([
                    name,
                    role,
                    stats.total || 0,
                    stats.wednesday || 0,
                    stats.meets_requirement ? 'ì¶©ì¡±' : 'ë¯¸ì¶©ì¡±',
                    role === 'ìš´ì˜ì§„' ? 'N/A' : achievementRate + '%'
                ]);
            }
            
            return result;
        }
        
        // CSV ì»¨í…ì¸  ìƒì„±
        function generateCSVContent(reportData) {
            var excelData = generateExcelData(reportData);
            var csvContent = '';
            
            for (var i = 0; i < excelData.length; i++) {
                var row = excelData[i];
                var csvRow = row.map(function(cell) {
                    // CSVì—ì„œ ì‰¼í‘œì™€ ë”°ì˜´í‘œ ì²˜ë¦¬
                    var cellStr = String(cell);
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        cellStr = '"' + cellStr.replace(/"/g, '""') + '"';
                    }
                    return cellStr;
                }).join(',');
                
                csvContent += csvRow + '\n';
            }
            
            // UTF-8 BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
            return '\uFEFF' + csvContent;
        }
        
        // ìš”ì•½ ë³´ê³ ì„œ ìƒì„±
        function generateSummaryReport(reportData) {
            var data = reportData.members || reportData;
            var dates = reportData.dates || [];
            var memberEntries = Object.keys(data);
            memberEntries.sort(function(a, b) {
                var orderA = data[a].order || 0;
                var orderB = data[b].order || 0;
                return orderA - orderB;
            });
            
            var report = '';
            report += '='.repeat(60) + '\n';
            report += '               ì¶œì„ ê´€ë¦¬ ì‹œìŠ¤í…œ ìš”ì•½ ë³´ê³ ì„œ\n';
            report += '='.repeat(60) + '\n';
            report += 'ë³´ê³ ì„œ ìƒì„±ì¼: ' + new Date().toLocaleString('ko-KR') + '\n';
            report += 'ëŒ€ìƒ ê¸°ê°„: ' + currentYear + 'ë…„ ' + currentMonth + 'ì›”\n';
            report += 'ì´ ì¶œì„ì¼: ' + dates.length + 'ì¼\n';
            report += 'ì´ ë©¤ë²„ìˆ˜: ' + memberEntries.length + 'ëª…\n';
            report += '\n';
            
            // ì—­í• ë³„ í†µê³„
            var roleStats = {};
            var totalPass = 0;
            var totalFail = 0;
            
            for (var i = 0; i < memberEntries.length; i++) {
                var name = memberEntries[i];
                var info = data[name];
                if (!info || !info.stats) continue;
                
                var role = info.role || 'ë¯¸ì •';
                if (!roleStats[role]) {
                    roleStats[role] = { total: 0, pass: 0, fail: 0 };
                }
                
                roleStats[role].total++;
                if (info.stats.meets_requirement) {
                    roleStats[role].pass++;
                    totalPass++;
                } else {
                    roleStats[role].fail++;
                    totalFail++;
                }
            }
            
            report += '[ ì—­í• ë³„ í†µê³„ ]\n';
            report += '-'.repeat(40) + '\n';
            for (var role in roleStats) {
                var stat = roleStats[role];
                var passRate = stat.total > 0 ? Math.round((stat.pass / stat.total) * 100) : 0;
                report += role + ': ' + stat.total + 'ëª… (ì¶©ì¡±: ' + stat.pass + 'ëª…, ë¯¸ì¶©ì¡±: ' + stat.fail + 'ëª…, ì¶©ì¡±ë¥ : ' + passRate + '%)\n';
            }
            report += '\n';
            
            report += '[ ì „ì²´ ìš”ì•½ ]\n';
            report += '-'.repeat(40) + '\n';
            var overallPassRate = (totalPass + totalFail) > 0 ? Math.round((totalPass / (totalPass + totalFail)) * 100) : 0;
            report += 'ì¡°ê±´ ì¶©ì¡±: ' + totalPass + 'ëª…\n';
            report += 'ì¡°ê±´ ë¯¸ì¶©ì¡±: ' + totalFail + 'ëª…\n';
            report += 'ì „ì²´ ì¶©ì¡±ë¥ : ' + overallPassRate + '%\n';
            report += '\n';
            
            report += '[ ê°œë³„ ë©¤ë²„ ìƒì„¸ ]\n';
            report += '-'.repeat(60) + '\n';
            
            for (var i = 0; i < memberEntries.length; i++) {
                var name = memberEntries[i];
                var info = data[name];
                if (!info || !info.stats) continue;
                
                var stats = info.stats;
                var role = info.role || 'ë¯¸ì •';
                
                report += (i + 1) + '. ' + name + ' (' + role + ')\n';
                report += '   ì´ ì¶œì„: ' + (stats.total || 0) + 'íšŒ';
                if (role === 'í˜ì´ì„œ ê°•ë‚¨') {
                    report += ' (ìˆ˜ìš”ì¼: ' + (stats.wednesday || 0) + 'íšŒ)';
                }
                report += '\n';
                
                if (role !== 'ìš´ì˜ì§„') {
                    report += '   í•„ìš” ì¶œì„: ' + (stats.required_total || 0) + 'íšŒ';
                    if (stats.required_wednesday > 0) {
                        report += ' (ìˆ˜ìš”ì¼: ' + stats.required_wednesday + 'íšŒ)';
                    }
                    report += '\n';
                    report += '   ì¡°ê±´ ì¶©ì¡±: ' + (stats.meets_requirement ? 'âœ“ ì¶©ì¡±' : 'âœ— ë¯¸ì¶©ì¡±') + '\n';
                }
                report += '\n';
            }
            
            report += '[ ì¶œì„ ì¡°ê±´ ì•ˆë‚´ ]\n';
            report += '-'.repeat(40) + '\n';
            report += 'â€¢ ìš´ì˜ì§„: ì¶œì„ ì¡°ê±´ ì—†ìŒ\n';
            report += 'â€¢ í˜ì´ì„œ: ì›” 3íšŒ ì´ìƒ ì¶œì„\n';
            report += 'â€¢ í˜ì´ì„œ ê°•ë‚¨: ì›” 3íšŒ ì´ìƒ ì¶œì„ (ê·¸ ì¤‘ ìˆ˜ìš”ì¼ 2íšŒ ì´ìƒ)\n';
            report += 'â€¢ í¬í† : ì›” 1íšŒ ì´ìƒ ì¶œì„\n';
            report += '\n';
            
            report += '='.repeat(60) + '\n';
            report += '                    ë³´ê³ ì„œ ë\n';
            report += '='.repeat(60) + '\n';
            
            return report;
        }
        
        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        function downloadFile(content, fileName, mimeType) {
            var blob = new Blob([content], { type: mimeType });
            var url = window.URL.createObjectURL(blob);
            
            var a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.style.display = 'none';
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            window.URL.revokeObjectURL(url);
        }

        // =============================================================================
        // IMPORT ê¸°ëŠ¥ë“¤
        // =============================================================================

        // íŒŒì¼ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function importFromFile() {
            var fileInput = document.getElementById('importFileInput');
            var file = fileInput.files[0];
            var messageDiv = document.getElementById('importMessage');

            if (!file) {
                showMessage('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error', messageDiv);
                return;
            }

            // ì§€ì›í•˜ëŠ” íŒŒì¼ í˜•ì‹ í™•ì¸
            var fileName = file.name.toLowerCase();
            if (fileName.endsWith('.json')) {
                importFileType = 'json';
                readJSONFile(file);
            } else if (fileName.endsWith('.xlsx')) {
                importFileType = 'excel';
                readExcelFile(file);
            } else if (fileName.endsWith('.csv')) {
                importFileType = 'csv';
                readCSVFile(file);
            } else {
                showMessage('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. JSON, Excel(.xlsx), CSV íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤.', 'error', messageDiv);
                return;
            }
        }

        // JSON íŒŒì¼ ì½ê¸°
        function readJSONFile(file) {
            var reader = new FileReader();
            var messageDiv = document.getElementById('importMessage');

            reader.onload = function(e) {
                try {
                    var jsonData = JSON.parse(e.target.result);

                    // JSON ë°ì´í„° í˜•ì‹ ê²€ì¦
                    if (validateJSONImportData(jsonData)) {
                        importData = jsonData;
                        showImportPreview();
                        showMessage('íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ì½ì—ˆìŠµë‹ˆë‹¤. ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•œ í›„ ê°€ì ¸ì˜¤ê¸°ë¥¼ ì§„í–‰í•˜ì„¸ìš”.', 'success', messageDiv);
                    } else {
                        showMessage('ì˜¬ë°”ë¥´ì§€ ì•Šì€ JSON ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.', 'error', messageDiv);
                    }
                } catch (error) {
                    showMessage('JSON íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message, 'error', messageDiv);
                }
            };

            reader.onerror = function() {
                showMessage('íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error', messageDiv);
            };

            reader.readAsText(file);
        }

        // Excel íŒŒì¼ ì½ê¸°
        function readExcelFile(file) {
            var reader = new FileReader();
            var messageDiv = document.getElementById('importMessage');

            reader.onload = function(e) {
                try {
                    var data = new Uint8Array(e.target.result);
                    var workbook = XLSX.read(data, { type: 'array' });

                    // ì²« ë²ˆì§¸ ì‹œíŠ¸ì—ì„œ ë°ì´í„° ì¶”ì¶œ
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    // Excel ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    var convertedData = convertExcelToImportData(jsonData);

                    if (convertedData) {
                        importData = convertedData;
                        showImportPreview();
                        showMessage('Excel íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ì½ì—ˆìŠµë‹ˆë‹¤. ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•œ í›„ ê°€ì ¸ì˜¤ê¸°ë¥¼ ì§„í–‰í•˜ì„¸ìš”.', 'success', messageDiv);
                    } else {
                        showMessage('Excel íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error', messageDiv);
                    }
                } catch (error) {
                    showMessage('Excel íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message, 'error', messageDiv);
                }
            };

            reader.onerror = function() {
                showMessage('íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error', messageDiv);
            };

            reader.readAsArrayBuffer(file);
        }

        // CSV íŒŒì¼ ì½ê¸°
        function readCSVFile(file) {
            var reader = new FileReader();
            var messageDiv = document.getElementById('importMessage');

            reader.onload = function(e) {
                try {
                    var csvText = e.target.result;
                    var lines = csvText.split('\n');
                    var csvData = [];

                    for (var i = 0; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            csvData.push(parseCSVLine(lines[i]));
                        }
                    }

                    // CSV ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    var convertedData = convertExcelToImportData(csvData); // Excelê³¼ ë™ì¼í•œ í˜•ì‹

                    if (convertedData) {
                        importData = convertedData;
                        showImportPreview();
                        showMessage('CSV íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ì½ì—ˆìŠµë‹ˆë‹¤. ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•œ í›„ ê°€ì ¸ì˜¤ê¸°ë¥¼ ì§„í–‰í•˜ì„¸ìš”.', 'success', messageDiv);
                    } else {
                        showMessage('CSV íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error', messageDiv);
                    }
                } catch (error) {
                    showMessage('CSV íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ' + error.message, 'error', messageDiv);
                }
            };

            reader.onerror = function() {
                showMessage('íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error', messageDiv);
            };

            reader.readAsText(file, 'UTF-8');
        }

        // CSV ë¼ì¸ íŒŒì‹±
        function parseCSVLine(line) {
            var result = [];
            var current = '';
            var inQuotes = false;

            for (var i = 0; i < line.length; i++) {
                var char = line[i];

                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }

            result.push(current.trim());
            return result;
        }

        // JSON ë°ì´í„° í˜•ì‹ ê²€ì¦
        function validateJSONImportData(data) {
            // ë‚´ë³´ë‚´ê¸° í˜•ì‹ì¸ì§€ í™•ì¸
            if (data.members && data.dates && data.year && data.month) {
                return true;
            }

            // ë°±ì—… í˜•ì‹ì¸ì§€ í™•ì¸
            if (data.data && typeof data.data === 'object') {
                return true;
            }

            return false;
        }

        // Excel/CSV ë°ì´í„°ë¥¼ import í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        function convertExcelToImportData(data) {
            if (data.length < 2) return null;

            var headers = data[0];
            var memberRows = data.slice(1);

            // í—¤ë”ì—ì„œ ë‚ ì§œ ì¶”ì¶œ
            var dates = [];
            var dateStartIndex = 3; // ì§ì±…, ì„±ëª…, í•©ê³„ ë‹¤ìŒë¶€í„°

            for (var i = dateStartIndex; i < headers.length; i++) {
                var header = headers[i];
                if (header && typeof header === 'string') {
                    // ë‚ ì§œ í˜•ì‹ íŒŒì‹± (ì˜ˆ: "6/1(ì›”)", "2024-06-01" ë“±)
                    var dateStr = parseDateFromHeader(header);
                    if (dateStr) {
                        dates.push(dateStr);
                    }
                }
            }

            if (dates.length === 0) return null;

            // ë©¤ë²„ ë°ì´í„° êµ¬ì„±
            var members = {};
            var order = 0;

            for (var i = 0; i < memberRows.length; i++) {
                var row = memberRows[i];
                if (row.length < 3) continue;

                var role = row[0];
                var name = row[1];

                if (!name || !role) continue;

                var attendance = {};
                for (var j = 0; j < dates.length; j++) {
                    var cellValue = row[dateStartIndex + j];
                    var status = 0;

                    if (cellValue === 'ì¶œì„' || cellValue === '1' || cellValue === 1) {
                        status = 1;
                    }

                    attendance[dates[j]] = status;
                }

                members[name] = {
                    role: role,
                    order: order++,
                    attendance: attendance,
                    stats: calculateStatsFromAttendance(attendance, role, dates)
                };
            }

            return {
                year: currentYear,
                month: currentMonth,
                members: members,
                dates: dates,
                exportDate: new Date().toISOString()
            };
        }

        // í—¤ë”ì—ì„œ ë‚ ì§œ íŒŒì‹±
        function parseDateFromHeader(header) {
            // "6/1(ì›”)" í˜•ì‹
            var match1 = header.match(/(\d+)\/(\d+)/);
            if (match1) {
                var month = parseInt(match1[1]);
                var day = parseInt(match1[2]);
                return currentYear + '-' + String(month).padStart(2, '0') + '-' + String(day).padStart(2, '0');
            }

            // "2024-06-01" í˜•ì‹
            var match2 = header.match(/(\d{4})-(\d{2})-(\d{2})/);
            if (match2) {
                return header;
            }

            return null;
        }

        // ì¶œì„ ë°ì´í„°ì—ì„œ í†µê³„ ê³„ì‚°
        function calculateStatsFromAttendance(attendance, role, dates) {
            var total = 0;
            var wednesday = 0;

            for (var i = 0; i < dates.length; i++) {
                var date = dates[i];
                if (attendance[date] === 1) {
                    total++;

                    var dateObj = new Date(date);
                    if (dateObj.getDay() === 3) {
                        wednesday++;
                    }
                }
            }

            // ì¡°ê±´ ì¶©ì¡± ì—¬ë¶€ ê³„ì‚°
            var requirements = {
                'ìš´ì˜ì§„': { total: 0, wednesday: 0 },
                'í˜ì´ì„œ': { total: 3, wednesday: 0 },
                'í˜ì´ì„œ ê°•ë‚¨': { total: 3, wednesday: 2 },
                'í¬í† ': { total: 1, wednesday: 0 }
            };

            var req = requirements[role] || { total: 0, wednesday: 0 };
            var meetsRequirement = role === 'ìš´ì˜ì§„' || 
                                 (total >= req.total && wednesday >= req.wednesday);

            return {
                total: total,
                wednesday: wednesday,
                meets_requirement: meetsRequirement,
                required_total: req.total,
                required_wednesday: req.wednesday
            };
        }

        // ê°€ì ¸ì˜¬ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showImportPreview() {
            var previewDiv = document.getElementById('importPreview');
            var previewContent = document.getElementById('previewContent');

            if (!importData) return;

            var html = '';
            html += '<p><strong>ğŸ—“ï¸ ëŒ€ìƒ ê¸°ê°„:</strong> ' + importData.year + 'ë…„ ' + importData.month + 'ì›”</p>';
            html += '<p><strong>ğŸ‘¥ ë©¤ë²„ ìˆ˜:</strong> ' + Object.keys(importData.members || {}).length + 'ëª…</p>';
            html += '<p><strong>ğŸ“… ì¶œì„ì¼ ìˆ˜:</strong> ' + (importData.dates || []).length + 'ì¼</p>';

            html += '<div style="margin-top: 15px;"><strong>ğŸ‘¤ ë©¤ë²„ ëª©ë¡:</strong></div>';
            html += '<div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-top: 5px; border-radius: 4px;">';

            var memberEntries = Object.keys(importData.members || {});
            memberEntries.sort(function(a, b) {
                var orderA = importData.members[a].order || 0;
                var orderB = importData.members[b].order || 0;
                return orderA - orderB;
            });

            for (var i = 0; i < memberEntries.length; i++) {
                var name = memberEntries[i];
                var member = importData.members[name];
                var stats = member.stats || {};

                html += '<div style="padding: 5px; border-bottom: 1px solid #eee;">';
                html += '<strong>' + name + '</strong> (' + (member.role || 'ë¯¸ì •') + ') - ';
                html += 'ì¶œì„: ' + (stats.total || 0) + 'íšŒ';
                if (member.role === 'í˜ì´ì„œ ê°•ë‚¨') {
                    html += ' (ìˆ˜ìš”ì¼: ' + (stats.wednesday || 0) + 'íšŒ)';
                }
                html += ' - ' + (stats.meets_requirement ? 'âœ… ì¶©ì¡±' : 'âŒ ë¯¸ì¶©ì¡±');
                html += '</div>';
            }

            html += '</div>';

            html += '<div style="margin-top: 15px; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px;">';
            html += '<strong>âš ï¸ ì£¼ì˜ì‚¬í•­:</strong><br>';
            html += 'â€¢ í˜„ì¬ ' + currentYear + 'ë…„ ' + currentMonth + 'ì›”ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤<br>';
            html += 'â€¢ ê°€ì ¸ì˜¤ê¸° ì „ì— í˜„ì¬ ë°ì´í„°ë¥¼ ë°±ì—…í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤<br>';
            html += 'â€¢ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
            html += '</div>';

            previewContent.innerHTML = html;
            previewDiv.style.display = 'block';

            // ë²„íŠ¼ë“¤ í‘œì‹œ
            document.getElementById('previewBtn').style.display = 'inline-block';
            document.getElementById('confirmBtn').style.display = 'inline-block';
            document.getElementById('cancelBtn').style.display = 'inline-block';
        }

        // ë¯¸ë¦¬ë³´ê¸° í™•ì¥
        function previewImportData() {
            // ìƒì„¸ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ì´ë‚˜ í˜ì´ì§€ë¥¼ ì—´ ìˆ˜ ìˆìŒ
            alert('ìƒì„¸ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ì€ í˜„ì¬ ìœ„ì˜ ìš”ì•½ ì •ë³´ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.');
        }

        // ê°€ì ¸ì˜¤ê¸° í™•ì •
        function confirmImport() {
            if (!importData) {
                showMessage('ê°€ì ¸ì˜¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error', document.getElementById('importMessage'));
                return;
            }

            if (!confirm('ì •ë§ë¡œ í˜„ì¬ ì›”(' + currentYear + 'ë…„ ' + currentMonth + 'ì›”)ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }

            var messageDiv = document.getElementById('importMessage');
            showMessage('ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...', 'info', messageDiv);

            // ì„œë²„ì— ë°ì´í„° ì „ì†¡
            fetch('/api/import_month_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    year: currentYear,
                    month: currentMonth,
                    data: importData
                })
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(result) {
                if (result.success) {
                    showMessage('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!', 'success', messageDiv);
                    resetImportUI();

                    // í™”ë©´ ìƒˆë¡œê³ ì¹¨
                    setTimeout(function() {
                        loadCurrentMonth();
                    }, 1000);
                } else {
                    showMessage('ë°ì´í„° ê°€ì ¸ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error', messageDiv);
                }
            })
            .catch(function(error) {
                showMessage('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error, 'error', messageDiv);
            });
        }

        // ê°€ì ¸ì˜¤ê¸° ì·¨ì†Œ
        function cancelImport() {
            resetImportUI();
            showMessage('ê°€ì ¸ì˜¤ê¸°ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.', 'info', document.getElementById('importMessage'));
        }

        // Import UI ì´ˆê¸°í™”
        function resetImportUI() {
            importData = null;
            importFileType = null;
            document.getElementById('importFileInput').value = '';
            document.getElementById('importPreview').style.display = 'none';
            document.getElementById('previewBtn').style.display = 'none';
            document.getElementById('confirmBtn').style.display = 'none';
            document.getElementById('cancelBtn').style.display = 'none';
        }

        // í˜„ì¬ ì›” ë°ì´í„° ë¡œë“œ
        function loadCurrentMonth() {
            currentYear = parseInt(document.getElementById('year').value);
            currentMonth = parseInt(document.getElementById('month').value);

            // í˜„ì¬ ì›” í‘œì‹œ ì—…ë°ì´íŠ¸
            updateCurrentMonthDisplay();

            loadMemberManagement();
            loadAttendanceTable();
        }

        // í˜„ì¬ ì›” í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateCurrentMonthDisplay() {
            var displayElement = document.getElementById('currentMonthDisplay');
            if (displayElement) {
                displayElement.textContent = currentYear + 'ë…„ ' + currentMonth + 'ì›”';
            }
        }

        // ì „ì›” ë©¤ë²„ ë³µì‚¬
        function copyFromPreviousMonth() {
            var messageDiv = document.getElementById('monthMessage');

            fetch('/api/copy_previous_month', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    year: currentYear,
                    month: currentMonth
                })
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.success) {
                    showMessage('ì „ì›” ë©¤ë²„ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤!', 'success', messageDiv);
                    // ì „ì›” ë©¤ë²„ ë³µì‚¬ í›„ ì²« ë²ˆì§¸ ë©¤ë²„ ì„ íƒ
                    selectedMemberIndex = 0;
                    loadCurrentMonthWithSync();
                } else {
                    showMessage('ì „ì›” ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error', messageDiv);
                }
            })
            .catch(function(error) {
                showMessage('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error, 'error', messageDiv);
            });
        }

        // ë©¤ë²„ ì¶”ê°€
        function addMember() {
            var name = document.getElementById('memberName').value.trim();
            var role = document.getElementById('memberRole').value;
            var messageDiv = document.getElementById('memberMessage');

            if (!name) {
                showMessage('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error', messageDiv);
                return;
            }

            fetch('/api/add_member', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    year: currentYear,
                    month: currentMonth,
                    name: name,
                    role: role
                })
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                if (data.success) {
                    showMessage('ë©¤ë²„ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', messageDiv);
                    document.getElementById('memberName').value = '';

                    // ë©¤ë²„ ì¶”ê°€ í›„ ì „ì²´ ì—…ë°ì´íŠ¸ (ìˆœì„œ ìœ ì§€)
                    loadCurrentMonthWithSync();
                } else {
                    showMessage('ë©¤ë²„ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error', messageDiv);
                }
            })
            .catch(function(error) {
                showMessage('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error, 'error', messageDiv);
            });
        }<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜ì´ì„œ ì¶œì„ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <!-- SortableJS ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ (Excel ë‚´ë³´ë‚´ê¸°ìš©) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        /* ë¡œê·¸ì¸ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 350px;
            max-width: 400px;
            width: 90%;
        }
        
        .login-container h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .login-container .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .login-form input {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .login-form input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .login-form input.error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .login-form button {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .login-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .login-form button:active {
            transform: translateY(0);
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            border-left: 4px solid #c62828;
        }
        
        .security-note {
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
            font-size: 0.85em;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }
        
        .forgot-password {
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .forgot-password:hover {
            color: #667eea;
        }
        
        /* ë©”ì¸ ì»¨í…ì¸ ëŠ” ìˆ¨ê¹€ */
        .main-content {
            display: none;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .logout-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        
        .logout-button:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        input, select, button {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }
        
        /* Export ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .export-section {
            border-left-color: #17a2b8;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .export-buttons button {
            min-width: 120px;
            font-size: 13px;
        }
        
        /* ë·° ì „í™˜ ë²„íŠ¼ - PCì™€ ëª¨ë°”ì¼ ëª¨ë‘ í‘œì‹œ */
        .view-toggle {
            display: block; /* í•­ìƒ í‘œì‹œ */
            text-align: center;
            margin-bottom: 20px;
        }
        
        .view-toggle button {
            margin: 0 5px;
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .view-toggle button.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        
        .view-toggle button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .attendance-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            min-width: 60px;
        }
        
        .attendance-table td {
            padding: 10px 6px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
            min-width: 60px;
        }
        
        .attendance-cell {
            cursor: pointer;
            user-select: none;
            font-weight: 600;
            transition: all 0.2s ease;
            border-radius: 4px;
            margin: 2px;
            padding: 8px;
            min-width: 40px;
            min-height: 40px;
            text-align: center;
            vertical-align: middle;
        }
        
        .attendance-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .present {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
        }
        
        .absent {
            background: white;
            color: #333;
            border: 2px solid #dee2e6;
        }
        
        .pass {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        
        .fail {
            background-color: #ffebee;
            color: #c62828;
        }
        
        /* ë©¤ë²„ ì„ íƒ ë“œë¡­ë‹¤ìš´ */
        .member-selector {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .member-selector select {
            min-width: 200px;
            font-size: 16px;
            padding: 12px 16px;
        }
        
        .member-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }
        
        /* ì¹´ë“œ ë·° ë‚´ë¹„ê²Œì´ì…˜ */
        .card-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .nav-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            min-width: 80px;
        }
        
        .nav-button:hover {
            background: #5a67d8;
        }
        
        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .member-indicator {
            font-weight: bold;
            color: #333;
            text-align: center;
            flex: 1;
            margin: 0 15px;
        }
        
        /* ë‹¨ì¼ ì¹´ë“œ í‘œì‹œ */
        .single-card-container {
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .no-member-selected {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px dashed #ddd;
        }
        
        .no-member-selected h3 {
            margin-bottom: 15px;
            color: #333;
        }
        .mobile-view {
            display: none;
        }
        
        .member-card-view {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }
        
        .member-card-view.fail {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .member-card-view.pass {
            border-left-color: #28a745;
            background: #f8fff8;
        }
        
        .member-header-mobile {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .member-name-mobile {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .member-role-mobile {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .member-stats-mobile {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }
        
        .attendance-grid-mobile {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        
        .attendance-item-mobile {
            text-align: center;
            padding: 10px 5px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .attendance-item-mobile:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .attendance-item-mobile.present {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border-color: #4caf50;
        }
        
        .attendance-item-mobile.absent {
            background: white;
            color: #333;
            border-color: #dee2e6;
        }
        
        .date-label-mobile {
            font-size: 0.7em;
            line-height: 1.2;
            margin-bottom: 5px;
        }
        
        .attendance-value-mobile {
            font-size: 1.1em;
            font-weight: bold;
        }
        
        /* ë©¤ë²„ ê´€ë¦¬ */
        .member-management {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .member-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 80px;
            cursor: move;
            position: relative;
        }
        
        .member-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: 40px;
        }
        
        .member-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            min-width: 100px;
        }
        
        .member-role {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .member-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .member-actions button {
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .drag-handle {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: move;
            color: #6c757d;
            font-size: 18px;
            padding: 5px;
        }
        
        .sortable-ghost {
            opacity: 0.3;
            background: #f8f9fa;
        }
        
        .sortable-drag {
            opacity: 0.6;
            transform: rotate(5deg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        /* PC ë²„ì „ ì¹´ë“œë·° ìµœì í™” */
        @media (min-width: 769px) {
            .desktop-view {
                display: block; /* PCì—ì„œ ê¸°ë³¸ê°’ì€ í…Œì´ë¸” ë·° */
            }
            
            .mobile-view {
                display: none; /* PCì—ì„œ ê¸°ë³¸ê°’ì€ ì¹´ë“œë·° ìˆ¨ê¹€ */
            }
            
            /* PCì—ì„œ ì¹´ë“œë·°ê°€ ì„ íƒëœ ê²½ìš° */
            .mobile-view.active {
                display: block;
            }
            
            .desktop-view.inactive {
                display: none;
            }
            
            /* PC ì¹´ë“œë·° ìŠ¤íƒ€ì¼ ì¡°ì • */
            .member-card-view {
                max-width: 800px;
                margin: 0 auto 20px auto;
            }
            
            .single-card-container {
                min-height: 300px;
            }
            
            /* PC ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
            .card-navigation {
                max-width: 600px;
                margin: 0 auto 20px auto;
            }
            
            .nav-button {
                padding: 12px 20px;
                font-size: 16px;
                min-width: 100px;
            }
            
            /* PC ë©¤ë²„ ì„ íƒ ë“œë¡­ë‹¤ìš´ */
            .member-selector {
                max-width: 400px;
                margin: 0 auto 20px auto;
            }
            
            .member-selector select {
                min-width: 250px;
                font-size: 16px;
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 15px;
            }
            
            .section {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .controls > * {
                width: 100%;
            }
            
            input, select, button {
                padding: 12px;
                font-size: 16px;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¹´ë“œ ë·° */
            .desktop-view {
                display: none;
            }
            
            .mobile-view {
                display: block;
            }
            
            .member-card {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
                padding: 15px;
            }
            
            .member-info {
                margin-left: 0;
                flex-direction: column;
                gap: 10px;
                align-items: center;
                text-align: center;
            }
            
            .member-actions {
                justify-content: center;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .drag-handle {
                position: static;
                transform: none;
                align-self: center;
                margin-bottom: 10px;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 20px;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .export-buttons button {
                width: 100%;
            }
            
            .login-container {
                padding: 30px 20px;
                min-width: 300px;
            }
            
            .logout-button {
                position: static;
                margin-bottom: 10px;
                display: block;
                width: fit-content;
                margin-left: auto;
                margin-right: auto;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <h1>ğŸ” ì‹œìŠ¤í…œ ì ‘ê·¼</h1>
            <p class="subtitle">í˜ì´ì„œ ì¶œì„ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            
            <form class="login-form" onsubmit="return handleLogin(event)">
                <input 
                    type="password" 
                    id="passwordInput" 
                    placeholder="ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                    required
                    autocomplete="current-password"
                >
                <button type="submit">ğŸš€ ì ‘ì†í•˜ê¸°</button>
            </form>
            
            <div id="loginError" class="error-message" style="display: none;"></div>
            
            <div class="forgot-password" onclick="showPasswordHint()">
                ğŸ’¡ ì•”í˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?
            </div>
            
            <div class="security-note">
                ğŸ›¡ï¸ <strong>ë³´ì•ˆ ì•ˆë‚´</strong><br>
                ì´ ì‹œìŠ¤í…œì€ ì¶œì„ ê´€ë¦¬ë¥¼ ìœ„í•œ ë³´í˜¸ëœ ì˜ì—­ì…ë‹ˆë‹¤.<br>
                ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <div class="header">
                <button class="logout-button" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                <h1>ğŸ“Ší˜ì´ì„œ ì¶œì„ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <p>í”¼ì§€í¬ í˜ì´ì„œ ì¶œì„ ê´€ë¦¬ì í˜ì´ì§€</p>
            </div>
            
            <div class="content">
                <!-- ì›” ì„ íƒ -->
                <div class="section">
                    <h2>ğŸ“… ì›” ì„ íƒ ë° ê´€ë¦¬</h2>
                    <div class="controls">
                        <label>ë…„ë„:</label>
                        <input type="number" id="year" value="2024" min="2020" max="2030">
                        <label>ì›”:</label>
                        <select id="month">
                            <option value="1">1ì›”</option>
                            <option value="2">2ì›”</option>
                            <option value="3">3ì›”</option>
                            <option value="4">4ì›”</option>
                            <option value="5">5ì›”</option>
                            <option value="6" selected>6ì›”</option>
                            <option value="7">7ì›”</option>
                            <option value="8">8ì›”</option>
                            <option value="9">9ì›”</option>
                            <option value="10">10ì›”</option>
                            <option value="11">11ì›”</option>
                            <option value="12">12ì›”</option>
                        </select>
                        <button onclick="loadCurrentMonth()">ì¡°íšŒ</button>
                        <button class="btn-success" onclick="copyFromPreviousMonth()">ì „ì›” ë©¤ë²„ ë³µì‚¬</button>
                    </div>
                    <div id="monthMessage"></div>
                </div>
                
                <!-- ë°ì´í„° Export -->
                <div class="section export-section">
                    <h2>ğŸ“ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h2>
                    <p>í˜„ì¬ ì„ íƒëœ ì›”ì˜ ì¶œì„ ë°ì´í„°ë¥¼ ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ë‚´ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="export-buttons">
                        <button class="btn-info" onclick="exportToExcel()">ğŸ“Š Excel íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                        <button class="btn-info" onclick="exportToCSV()">ğŸ“‹ CSV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                        <button class="btn-info" onclick="exportToJSON()">ğŸ’¾ JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                        <button class="btn-info" onclick="exportSummaryReport()">ğŸ“ˆ ìš”ì•½ ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°</button>
                    </div>
                    <div id="exportMessage"></div>
                </div>
                
                <!-- ë°ì´í„° Import -->
                <div class="section export-section">
                    <h2>ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</h2>
                    <p><strong>âš ï¸ ì£¼ì˜:</strong> ê°€ì ¸ì˜¨ ë°ì´í„°ëŠ” í˜„ì¬ ì„ íƒëœ ì›”(<span id="currentMonthDisplay"></span>)ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ë®ì–´ì”ë‹ˆë‹¤!</p>
                    <div class="controls">
                        <input type="file" id="importFileInput" accept=".json,.xlsx,.csv" style="margin-bottom: 10px;">
                        <div class="export-buttons">
                            <button class="btn-warning" onclick="importFromFile()">ğŸ“ íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¤ê¸°</button>
                            <button class="btn-secondary" onclick="previewImportData()" id="previewBtn" style="display: none;">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
                            <button class="btn-success" onclick="confirmImport()" id="confirmBtn" style="display: none;">âœ… ê°€ì ¸ì˜¤ê¸° í™•ì •</button>
                            <button class="btn-danger" onclick="cancelImport()" id="cancelBtn" style="display: none;">âŒ ì·¨ì†Œ</button>
                        </div>
                    </div>
                    <div id="importMessage"></div>
                    <div id="importPreview" style="display: none; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #17a2b8;">
                        <h4>ğŸ“‹ ê°€ì ¸ì˜¬ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h4>
                        <div id="previewContent"></div>
                    </div>
                </div>
                
                <!-- ë©¤ë²„ ì¶”ê°€ -->
                <div class="section">
                    <h2>ğŸ‘¥ ë©¤ë²„ ì¶”ê°€</h2>
                    <div class="controls">
                        <input type="text" id="memberName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                        <select id="memberRole">
                            <option value="ìš´ì˜ì§„">ìš´ì˜ì§„</option>
                            <option value="í˜ì´ì„œ">í˜ì´ì„œ</option>
                            <option value="í˜ì´ì„œ ê°•ë‚¨">í˜ì´ì„œ ê°•ë‚¨</option>
                            <option value="í¬í† ">í¬í† </option>
                        </select>
                        <button onclick="addMember()">ë©¤ë²„ ì¶”ê°€</button>
                    </div>
                    <div id="memberMessage"></div>
                </div>
                
                <!-- ì¶œì„ í˜„í™© -->
                <div class="section">
                    <h2>ğŸ“Š ì¶œì„ í˜„í™©</h2>
                    <div id="attendanceTable">
                        <div class="loading">ì¶œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
                    </div>
                </div>
                
                <!-- ë©¤ë²„ ê´€ë¦¬ -->
                <div class="section">
                    <h2>ğŸ‘¤ ë©¤ë²„ ê´€ë¦¬</h2>
                    <div id="memberManagement">
                        <div class="loading">ë©¤ë²„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì—­í•  ë³€ê²½ ëª¨ë‹¬ -->
    <div id="roleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì—­í•  ë³€ê²½</h3>
                <span class="close" onclick="closeRoleModal()">&times;</span>
            </div>
            <div>
                <p id="roleModalMemberName"></p>
                <select id="newRole">
                    <option value="ìš´ì˜ì§„">ìš´ì˜ì§„</option>
                    <option value="í˜ì´ì„œ">í˜ì´ì„œ</option>
                    <option value="í˜ì´ì„œ ê°•ë‚¨">í˜ì´ì„œ ê°•ë‚¨</option>
                    <option value="í¬í† ">í¬í† </option>
                </select>
                <div style="margin-top: 20px;">
                    <button onclick="updateMemberRole()">ë³€ê²½</button>
                    <button class="btn-secondary" onclick="closeRoleModal()">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================================================
        // ë³´ì•ˆ ë° ì¸ì¦ ê´€ë ¨ ì½”ë“œ
        // =============================================================================
        
        // ì„¤ì • ê°€ëŠ¥í•œ ì•”í˜¸ë“¤
        const VALID_PASSWORDS = [
            'pacer2024',        // ê¸°ë³¸ ì•”í˜¸
            'physique2024',     // ëŒ€ì²´ ì•”í˜¸
            'attendance2024'    // ê´€ë¦¬ì ì•”í˜¸
        ];
        
        const PASSWORD_HINTS = {
            'pacer2024': 'í˜ì´ì„œ + ì˜¬í•´ ë…„ë„',
            'physique2024': 'í”¼ì§€í¬ + ì˜¬í•´ ë…„ë„',
            'attendance2024': 'ì¶œì„ ì˜ì–´ + ì˜¬í•´ ë…„ë„'
        };
        
        // ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ (ë°€ë¦¬ì´ˆ) - 1ì‹œê°„
        const SESSION_TIMEOUT = 60 * 60 * 1000;
        
        // ë¡œê·¸ì¸ ì‹œë„ ì œí•œ
        let loginAttempts = 0;
        const MAX_LOGIN_ATTEMPTS = 5;
        const LOCKOUT_TIME = 15 * 60 * 1000; // 15ë¶„
        
        // ì„¸ì…˜ ê´€ë¦¬
        let sessionTimer = null;
        
        // ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin(event) {
            event.preventDefault();
            
            const lockoutTime = localStorage.getItem('attendance_lockout');
            if (lockoutTime && Date.now() < parseInt(lockoutTime)) {
                showLockoutMessage();
                return false;
            }
            
            const passwordInput = document.getElementById('passwordInput');
            const password = passwordInput.value.trim();
            
            if (!password) {
                showLoginError('âŒ ì•”í˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            // ì•”í˜¸ í™•ì¸
            if (VALID_PASSWORDS.includes(password)) {
                // ë¡œê·¸ì¸ ì„±ê³µ
                loginSuccess();
            } else {
                // ë¡œê·¸ì¸ ì‹¤íŒ¨
                loginAttempts++;
                
                if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                    // ê³„ì • ì ê¸ˆ
                    localStorage.setItem('attendance_lockout', (Date.now() + LOCKOUT_TIME).toString());
                    showLockoutMessage();
                } else {
                    const remainingAttempts = MAX_LOGIN_ATTEMPTS - loginAttempts;
                    showLoginError(`âŒ ì˜ëª»ëœ ì•”í˜¸ì…ë‹ˆë‹¤. (${remainingAttempts}ë²ˆì˜ ì‹œë„ê°€ ë‚¨ì•˜ìŠµë‹ˆë‹¤)`);
                    
                    // ì…ë ¥ í•„ë“œ í”ë“¤ë¦¼ íš¨ê³¼
                    passwordInput.style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        passwordInput.style.animation = '';
                    }, 500);
                }
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                passwordInput.value = '';
                passwordInput.focus();
            }
            
            return false;
        }
        
        // ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
        function loginSuccess() {
            // ì„¸ì…˜ ì •ë³´ ì €ì¥
            sessionStorage.setItem('attendance_authenticated', 'true');
            sessionStorage.setItem('attendance_login_time', Date.now().toString());
            
            // ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì´ˆê¸°í™”
            loginAttempts = 0;
            localStorage.removeItem('attendance_lockout');
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.innerHTML = `
                    <div style="background: #e8f5e8; color: #2e7d32; border-left-color: #4caf50;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.2em;">âœ…</span>
                            <span>ë¡œê·¸ì¸ ì„±ê³µ! ì‹œìŠ¤í…œì— ì ‘ì†í•©ë‹ˆë‹¤...</span>
                        </div>
                    </div>
                `;
                errorDiv.style.display = 'block';
            }
            
            // 0.8ì´ˆ í›„ ë©”ì¸ ì»¨í…ì¸  í‘œì‹œ
            setTimeout(() => {
                showMainContent();
                startSessionTimer();
                initializeMainContent();
            }, 800);
        }
        
        // ë¡œê·¸ì•„ì›ƒ
        function logout(message = null) {
            // ì„¸ì…˜ ì •ë³´ ì‚­ì œ
            sessionStorage.removeItem('attendance_authenticated');
            sessionStorage.removeItem('attendance_login_time');
            
            // ì„¸ì…˜ íƒ€ì´ë¨¸ ì •ì§€
            if (sessionTimer) {
                clearTimeout(sessionTimer);
                sessionTimer = null;
            }
            
            // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
            showLoginScreen();
            
            // ë©”ì‹œì§€ í‘œì‹œ
            if (message) {
                setTimeout(() => {
                    showLoginError(message);
                }, 100);
            }
        }
        
        // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
        function showLoginScreen() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” ë° í¬ì»¤ìŠ¤
            const passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.value = '';
                setTimeout(() => passwordInput.focus(), 100);
            }
            
            // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        }
        
        // ë©”ì¸ ì»¨í…ì¸  í‘œì‹œ
        function showMainContent() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        }
        
        // ë¡œê·¸ì¸ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            const passwordInput = document.getElementById('passwordInput');
            
            if (errorDiv) {
                errorDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 1.2em;">ğŸš¨</span>
                        <span>${message}</span>
                    </div>
                `;
                errorDiv.style.display = 'block';
                
                // ì…ë ¥ í•„ë“œì— ì—ëŸ¬ ìŠ¤íƒ€ì¼ ì¶”ê°€
                if (passwordInput) {
                    passwordInput.classList.add('error');
                    setTimeout(() => {
                        passwordInput.classList.remove('error');
                    }, 3000);
                }
                
                // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // ì ê¸ˆ ë©”ì‹œì§€ í‘œì‹œ
        function showLockoutMessage() {
            const lockoutTime = localStorage.getItem('attendance_lockout');
            if (lockoutTime) {
                const remainingTime = Math.ceil((parseInt(lockoutTime) - Date.now()) / 1000 / 60);
                showLoginError(`ğŸ”’ ë³´ì•ˆì„ ìœ„í•´ ê³„ì •ì´ ì ê²¼ìŠµë‹ˆë‹¤. ${remainingTime}ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);
            }
        }
        
        // ì•”í˜¸ íŒíŠ¸ í‘œì‹œ
        function showPasswordHint() {
            const hints = Object.values(PASSWORD_HINTS);
            const hintMessage = `ì•”í˜¸ íŒíŠ¸:\n${hints.map((hint, index) => `â€¢ ${hint}`).join('\n')}`;
            alert(hintMessage);
        }
        
        // ì„¸ì…˜ íƒ€ì´ë¨¸ ì‹œì‘
        function startSessionTimer() {
            if (sessionTimer) {
                clearTimeout(sessionTimer);
            }
            
            sessionTimer = setTimeout(() => {
                logout('ë³´ì•ˆì„ ìœ„í•´ ìë™ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
            }, SESSION_TIMEOUT);
        }
        
        // ì‚¬ìš©ì í™œë™ ê°ì§€ (ì„¸ì…˜ ì—°ì¥)
        document.addEventListener('click', extendSession);
        document.addEventListener('keypress', extendSession);
        document.addEventListener('scroll', extendSession);
        
        function extendSession() {
            const isAuthenticated = sessionStorage.getItem('attendance_authenticated');
            if (isAuthenticated) {
                sessionStorage.setItem('attendance_login_time', Date.now().toString());
                startSessionTimer();
            }
        }
        
        // ì¸ì¦ ìƒíƒœ í™•ì¸
        function checkAuthenticationStatus() {
            const isAuthenticated = sessionStorage.getItem('attendance_authenticated');
            const loginTime = sessionStorage.getItem('attendance_login_time');
            const lockoutTime = localStorage.getItem('attendance_lockout');
            
            // ì ê¸ˆ ìƒíƒœ í™•ì¸
            if (lockoutTime && Date.now() < parseInt(lockoutTime)) {
                showLockoutMessage();
                return;
            }
            
            // ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ í™•ì¸
            if (isAuthenticated && loginTime) {
                const timeSinceLogin = Date.now() - parseInt(loginTime);
                if (timeSinceLogin < SESSION_TIMEOUT) {
                    // ì¸ì¦ëœ ìƒíƒœ - ë©”ì¸ ì»¨í…ì¸  í‘œì‹œ
                    showMainContent();
                    startSessionTimer();
                    initializeMainContent();
                } else {
                    // ì„¸ì…˜ ë§Œë£Œ
                    logout('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                }
            } else {
                // ë¯¸ì¸ì¦ ìƒíƒœ - ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
                showLoginScreen();
            }
        }
        
        // ë©”ì¸ ì»¨í…ì¸  ì´ˆê¸°í™”
        function initializeMainContent() {
            var currentDate = new Date();
            currentYear = currentDate.getFullYear();
            currentMonth = currentDate.getMonth() + 1;
            
            document.getElementById('year').value = currentYear;
            document.getElementById('month').value = currentMonth;
            
            // Enter í‚¤ ì²˜ë¦¬
            document.getElementById('memberName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addMember();
                }
            });
            
            // ë…„ë„/ì›” ë³€ê²½ ì‹œ ìë™ ì¡°íšŒ
            document.getElementById('year').addEventListener('change', loadCurrentMonth);
            document.getElementById('month').addEventListener('change', loadCurrentMonth);
            
            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            loadCurrentMonth();
            updateCurrentMonthDisplay();
            
            // íŒŒì¼ ì…ë ¥ ë³€ê²½ ê°ì§€
            document.getElementById('importFileInput').addEventListener('change', function(e) {
                resetImportUI();
            });
        }
        
        // =============================================================================
        // ê¸°ì¡´ ì‹œìŠ¤í…œ ì½”ë“œ (ì›ë³¸ ê·¸ëŒ€ë¡œ ìœ ì§€)
        // =============================================================================
        
        // ì „ì—­ ë³€ìˆ˜
        var currentYear = 2024;
        var currentMonth = 6;
        var currentMembers = {};
        var editingMember = null;
        var currentView = 'auto'; // ìë™ ê°ì§€ (ëª¨ë°”ì¼: card, PC: table)
        var selectedMemberIndex = 0; // í˜„ì¬ ì„ íƒëœ ë©¤ë²„ ì¸ë±ìŠ¤
        var memberList = []; // ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ (ì •ë ¬ëœ)
        var userSelectedView = null; // ì‚¬ìš©ìê°€ ì§ì ‘ ì„ íƒí•œ ë·° (nullì´ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
        var currentReportData = null; // í˜„ì¬ ë³´ê³ ì„œ ë°ì´í„° (exportìš©)
        var importData = null; // ê°€ì ¸ì˜¬ ë°ì´í„° ì„ì‹œ ì €ì¥
        var importFileType = null; // ê°€ì ¸ì˜¬ íŒŒì¼ íƒ€ì…
        
        // í˜„ì¬ í™˜ê²½ì´ ëª¨ë°”ì¼ì¸ì§€ í™•ì¸
        function isMobile() {
            return window.innerWidth <= 768;
        }
        
        // ê¸°ë³¸ ë·° ê²°ì • (ëª¨ë°”ì¼: card, PC: table)
        function getDefaultView() {
            return isMobile() ? 'card' : 'table';
        }
        
        // í˜„ì¬ ì‚¬ìš©í•´ì•¼ í•  ë·° ê²°ì •
        function getCurrentView() {
            // ì‚¬ìš©ìê°€ ì§ì ‘ ì„ íƒí•œ ë·°ê°€ ìˆìœ¼ë©´ ê·¸ê²ƒ ì‚¬ìš©
            if (userSelectedView) {
                return userSelectedView;
            }
            // ì—†ìœ¼ë©´ í™˜ê²½ì— ë§ëŠ” ê¸°ë³¸ê°’ ì‚¬ìš©
            return getDefaultView();
        }

        // Excel íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
        function exportToExcel() {
            if (!currentReportData) {
                showMessage('ë¨¼ì € ì¶œì„ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.', 'error', document.getElementById('exportMessage'));
                return;
            }
            
            try {
                var wb = XLSX.utils.book_new();
                
                // ì¶œì„ í˜„í™© ì‹œíŠ¸
                var wsData = generateExcelData(currentReportData);
                var ws = XLSX.utils.aoa_to_sheet(wsData);
                
                // ì—´ ë„ˆë¹„ ì„¤ì •
                var colWidths = [
                    { wch: 12 }, // ì§ì±…
                    { wch: 15 }, // ì„±ëª…
                    { wch: 8 },  // í•©ê³„
                ];
                
                var dates = currentReportData.dates || [];
                for (var i = 0; i < dates.length; i++) {
                    colWidths.push({ wch: 10 });
                }
                
                ws['!cols'] = colWidths;
                
                XLSX.utils.book_append_sheet(wb, ws, "ì¶œì„í˜„í™©");
                
                // ìš”ì•½ í†µê³„ ì‹œíŠ¸
                var summaryData = generateSummaryData(currentReportData);
                var summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
                summaryWs['!cols'] = [
                    { wch: 15 }, // ì´ë¦„
                    { wch: 12 }, // ì§ì±…
                    { wch: 10 }, // ì´ ì¶œì„
                    { wch: 12 }, // ìˆ˜ìš”ì¼ ì¶œì„
                    { wch: 10 }, // ì¡°ê±´ ì¶©ì¡±
                    { wch: 12 }  // ë‹¬ì„±ë¥ 
                ];
                
                XLSX.utils.book_append_sheet(wb, summaryWs, "ìš”ì•½í†µê³„");
                
                // íŒŒì¼ëª… ìƒì„±
                var fileName = currentYear + 'ë…„_' + currentMonth + 'ì›”_ì¶œì„í˜„í™©.xlsx';
                
                // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                XLSX.writeFile(wb, fileName);
                
                showMessage('Excel íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', document.getElementById('exportMessage'));
            } catch (error) {
                showMessage('Excel íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error', document.getElementById('exportMessage'));
                console.error('Excel export error:', error);
            }
        }
        
        // CSV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
        function exportToCSV() {
            if (!currentReportData) {
                showMessage('ë¨¼ì € ì¶œì„ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.', 'error', document.getElementById('exportMessage'));
                return;
            }
            
            try {
                var csvContent = generateCSVContent(currentReportData);
                var fileName = currentYear + 'ë…„_' + currentMonth + 'ì›”_ì¶œì„í˜„í™©.csv';
                
                downloadFile(csvContent, fileName, 'text/csv;charset=utf-8;');
                
                showMessage('CSV íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', document.getElementById('exportMessage'));
            } catch (error) {
                showMessage('CSV íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error', document.getElementById('exportMessage'));
                console.error('CSV export error:', error);
            }
        }
        
        // JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
        function exportToJSON() {
            if (!currentReportData) {
                showMessage('ë¨¼ì € ì¶œì„ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.', 'error', document.getElementById('exportMessage'));
                return;
            }
            
            try {
                var jsonData = {
                    exportDate: new Date().toISOString(),
                    year: currentYear,
                    month: currentMonth,
                    data: currentReportData
                };
                
                var jsonContent = JSON.stringify(jsonData, null, 2);
                var fileName = currentYear + 'ë…„_' + currentMonth + 'ì›”_ì¶œì„ë°ì´í„°.json';
                
                downloadFile(jsonContent, fileName, 'application/json;charset=utf-8;');
                
                showMessage('JSON íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', document.getElementById('exportMessage'));
            } catch (error) {
                showMessage('JSON íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error', document.getElementById('exportMessage'));
                console.error('JSON export error:', error);
            }
        }
        
        // ìš”ì•½ ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
        function exportSummaryReport() {
            if (!currentReportData) {
                showMessage('ë¨¼ì € ì¶œì„ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì£¼ì„¸ìš”.', 'error', document.getElementById('exportMessage'));
                return;
            }
            
            try {
                var reportContent = generateSummaryReport(currentReportData);
                var fileName = currentYear + 'ë…„_' + currentMonth + 'ì›”_ì¶œì„ìš”ì•½ë³´ê³ ì„œ.txt';
                
                downloadFile(reportContent, fileName, 'text/plain;charset=utf-8;');
                
                showMessage('ìš”ì•½ ë³´ê³ ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', document.getElementById('exportMessage'));
            } catch (error) {
                showMessage('ìš”ì•½ ë³´ê³ ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error', document.getElementById('exportMessage'));
                console.error('Summary report error:', error);
            }
        }
